{% extends "base.html" %}

{% block title %}{{ 'Edit' if deal else 'Add' }} Deal - CRM App{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">{{ 'Edit' if deal else 'Add New' }} Deal</h1>
        <p class="text-gray-600">{{ 'Update deal information' if deal else 'Create a new sales deal' }}</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
        <form method="POST">
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">Deal Title *</label>
                    <input type="text" id="title" name="title" value="{{ deal.title if deal }}" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" 
                           required>
                </div>

                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                    <textarea id="description" name="description" rows="3" 
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">{{ deal.description if deal }}</textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="value" class="block text-sm font-medium text-gray-700">Deal Value ($)</label>
                        <input type="number" id="value" name="value" step="0.01" value="{{ deal.value if deal }}" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>

                    <div>
                        <label for="probability" class="block text-sm font-medium text-gray-700">Probability (%)</label>
                        <input type="number" id="probability" name="probability" min="0" max="100" value="{{ deal.probability if deal else 0 }}" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="client_id" class="block text-sm font-medium text-gray-700">Client *</label>
                        <select id="client_id" name="client_id" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="">Select a client</option>
                            {% for client in clients %}
                            <option value="{{ client.id }}" {{ 'selected' if deal and deal.client_id == client.id }}>
                                {{ client.name }} - {{ client.company or 'No company' }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label for="stage" class="block text-sm font-medium text-gray-700">Stage</label>
                        <select id="stage" name="stage" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="prospect" {{ 'selected' if deal and deal.stage == 'prospect' }}>Prospect</option>
                            <option value="qualified" {{ 'selected' if deal and deal.stage == 'qualified' }}>Qualified</option>
                            <option value="proposal" {{ 'selected' if deal and deal.stage == 'proposal' }}>Proposal</option>
                            <option value="negotiation" {{ 'selected' if deal and deal.stage == 'negotiation' }}>Negotiation</option>
                            <option value="closed_won" {{ 'selected' if deal and deal.stage == 'closed_won' }}>Closed Won</option>
                            <option value="closed_lost" {{ 'selected' if deal and deal.stage == 'closed_lost' }}>Closed Lost</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label for="expected_close" class="block text-sm font-medium text-gray-700">Expected Close Date</label>
                    <input type="date" id="expected_close" name="expected_close" 
                           value="{{ deal.expected_close if deal and deal.expected_close }}" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <a href="{{ url_for('deals') }}" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition duration-200">
                        Cancel
                    </a>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200">
                        {{ 'Update' if deal else 'Create' }} Deal
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}